<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

	<changeSet id="CSET.SEQUENCE_GENERATOR_TABLES"
		author="Dmitry Mikhaylenko">
		<createTable tableName="SEQUENCES"
			remarks="The current state of sequence generator">
			<column name="SEQUENCE_NAME" type="VARCHAR(40)"
				remarks="The sequence generator name">
				<constraints nullable="false" />
			</column>
			<column name="SEQUENCE_VALUE" type="BIGINT(20)"
				defaultValueNumeric="0" remarks="The last generated value">
				<constraints nullable="false" />
			</column>
			<column name="LAST_HISTORY_MARKER" type="VARCHAR(36)"
				remarks="The last histoy marker identifier in the history table">
				<constraints nullable="false" />
			</column>
		</createTable>

		<addPrimaryKey columnNames="SEQUENCE_NAME"
			tableName="SEQUENCES" />

		<addUniqueConstraint
			constraintName="UNC__LAST_HISTORY_MARKER"
			columnNames="LAST_HISTORY_MARKER" tableName="SEQUENCES" />

		<createTable tableName="SEQUENCE_VALUES_HISTORY"
			remarks="The sequences generations history table">
			<column name="GUID" type="VARCHAR(36)"
				remarks="The historical identifier">
				<constraints nullable="false" />
			</column>
			<column name="SEQUENCE_VALUE" type="BIGINT(20)"
				remarks="The generated value">
				<constraints nullable="false" />
			</column>
		</createTable>

		<addPrimaryKey columnNames="GUID"
			tableName="SEQUENCE_VALUES_HISTORY" />
	</changeSet>

	<changeSet id="CSET.SEQUENCE_GENERATOR"
		author="Dmitry Mikhaylenko">
		<sqlFile encoding="UTF-8" endDelimiter="/"
			splitStatements="true" stripComments="true"
			path="liquibase/v0.0.1/create_sequence_generator.sql" />
		<rollback>
			<sqlFile encoding="UTF-8" splitStatements="true"
				stripComments="true"
				path="liquibase/v0.0.1/drop_sequence_generator.sql" />
		</rollback>
	</changeSet>
</databaseChangeLog>
